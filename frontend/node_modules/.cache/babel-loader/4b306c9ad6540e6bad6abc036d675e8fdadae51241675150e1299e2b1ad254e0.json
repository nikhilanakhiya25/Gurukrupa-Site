{"ast":null,"code":"// frontend/src/components/Cart/Payment.jsx\nimport React,{useState,useContext,useEffect}from\"react\";import{CartContext}from\"../../contexts/CartContext\";import{useNavigate}from\"react-router-dom\";import API from\"../../api/api\";import\"./Payments.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Payment(){const{cart,clearCart}=useContext(CartContext);const navigate=useNavigate();const[selectedMethod,setSelectedMethod]=useState(\"COD\");const[confirmPopup,setConfirmPopup]=useState(false);const[shippingDetails,setShippingDetails]=useState(null);// üîπ Load shipping details\nuseEffect(()=>{const saved=JSON.parse(localStorage.getItem(\"shippingDetails\"));if(!saved){navigate(\"/checkout\");return;}setShippingDetails(saved);},[navigate]);// üîπ Calculate total\nconst totalPrice=cart.reduce((sum,item)=>sum+item.price*item.qty,0);// üîπ PLACE ORDER (FIXED)\nconst placeOrder=async()=>{try{// ‚úÖ CREATE orderData (THIS WAS MISSING)\nconst orderData={orderItems:cart.map(item=>({product:item._id,name:item.name,price:item.price,qty:item.qty,image:item.image})),shippingAddress:shippingDetails,paymentMethod:selectedMethod,totalPrice};console.log(\"üì¶ Sending Order:\",orderData);// ‚úÖ baseURL already has /api ‚Üí DO NOT add /api again\nconst res=await API.post(\"/\",orderData);console.log(\"‚úÖ ORDER SUCCESS:\",res.data);clearCart();localStorage.removeItem(\"shippingDetails\");navigate(\"/order-success/\"+res.data._id);}catch(error){var _error$response,_error$response2,_error$response2$data;console.error(\"‚ùå ORDER ERROR:\",((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error.message);alert(\"Order failed: \"+(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||\"Unknown error\"));}};return/*#__PURE__*/_jsxs(\"div\",{className:\"payment-page\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Select Payment Method\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-box\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment-option \".concat(selectedMethod===\"COD\"?\"active\":\"\"),onClick:()=>setSelectedMethod(\"COD\"),children:\"Cash on Delivery (COD)\"}),/*#__PURE__*/_jsx(\"button\",{className:\"continue-btn\",onClick:()=>setConfirmPopup(true),children:\"Continue\"})]}),confirmPopup&&/*#__PURE__*/_jsx(\"div\",{className:\"popup-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"popup-box\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Confirm Order?\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Your order will be placed successfully.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"popup-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"cancel-btn\",onClick:()=>setConfirmPopup(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{className:\"place-btn\",onClick:placeOrder,children:\"Place Order\"})]})]})})]});}","map":{"version":3,"names":["React","useState","useContext","useEffect","CartContext","useNavigate","API","jsx","_jsx","jsxs","_jsxs","Payment","cart","clearCart","navigate","selectedMethod","setSelectedMethod","confirmPopup","setConfirmPopup","shippingDetails","setShippingDetails","saved","JSON","parse","localStorage","getItem","totalPrice","reduce","sum","item","price","qty","placeOrder","orderData","orderItems","map","product","_id","name","image","shippingAddress","paymentMethod","console","log","res","post","data","removeItem","error","_error$response","_error$response2","_error$response2$data","response","message","alert","className","children","concat","onClick"],"sources":["C:/Users/anakhiya nikhil/OneDrive/Desktop/mern-ecommerce-full/Gurukrupa-Site/frontend/src/components/Cart/payment.jsx"],"sourcesContent":["// frontend/src/components/Cart/Payment.jsx\r\nimport React, { useState, useContext, useEffect } from \"react\";\r\nimport { CartContext } from \"../../contexts/CartContext\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport API from \"../../api/api\";\r\nimport \"./Payments.css\";\r\n\r\nexport default function Payment() {\r\n    const { cart, clearCart } = useContext(CartContext);\r\n    const navigate = useNavigate();\r\n\r\n    const [selectedMethod, setSelectedMethod] = useState(\"COD\");\r\n    const [confirmPopup, setConfirmPopup] = useState(false);\r\n    const [shippingDetails, setShippingDetails] = useState(null);\r\n\r\n    // üîπ Load shipping details\r\n    useEffect(() => {\r\n        const saved = JSON.parse(localStorage.getItem(\"shippingDetails\"));\r\n        if (!saved) {\r\n            navigate(\"/checkout\");\r\n            return;\r\n        }\r\n        setShippingDetails(saved);\r\n    }, [navigate]);\r\n\r\n    // üîπ Calculate total\r\n    const totalPrice = cart.reduce(\r\n        (sum, item) => sum + item.price * item.qty,\r\n        0\r\n    );\r\n\r\n    // üîπ PLACE ORDER (FIXED)\r\n    const placeOrder = async () => {\r\n        try {\r\n            // ‚úÖ CREATE orderData (THIS WAS MISSING)\r\n            const orderData = {\r\n                orderItems: cart.map((item) => ({\r\n                    product: item._id,\r\n                    name: item.name,\r\n                    price: item.price,\r\n                    qty: item.qty,\r\n                    image: item.image,\r\n                })),\r\n                shippingAddress: shippingDetails,\r\n                paymentMethod: selectedMethod,\r\n                totalPrice,\r\n            };\r\n\r\n            console.log(\"üì¶ Sending Order:\", orderData);\r\n\r\n            // ‚úÖ baseURL already has /api ‚Üí DO NOT add /api again\r\n            const res = await API.post(\"/\", orderData);\r\n\r\n            console.log(\"‚úÖ ORDER SUCCESS:\", res.data);\r\n\r\n            clearCart();\r\n            localStorage.removeItem(\"shippingDetails\");\r\n\r\n            navigate(\"/order-success/\" + res.data._id);\r\n        } catch (error) {\r\n            console.error(\"‚ùå ORDER ERROR:\", error.response?.data || error.message);\r\n            alert(\r\n                \"Order failed: \" +\r\n                (error.response?.data?.message || \"Unknown error\")\r\n            );\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"payment-page\">\r\n            <h2>Select Payment Method</h2>\r\n\r\n            <div className=\"payment-box\">\r\n                <div\r\n                    className={`payment-option ${selectedMethod === \"COD\" ? \"active\" : \"\"\r\n                        }`}\r\n                    onClick={() => setSelectedMethod(\"COD\")}\r\n                >\r\n                    Cash on Delivery (COD)\r\n                </div>\r\n\r\n                <button\r\n                    className=\"continue-btn\"\r\n                    onClick={() => setConfirmPopup(true)}\r\n                >\r\n                    Continue\r\n                </button>\r\n            </div>\r\n\r\n            {confirmPopup && (\r\n                <div className=\"popup-overlay\">\r\n                    <div className=\"popup-box\">\r\n                        <h3>Confirm Order?</h3>\r\n                        <p>Your order will be placed successfully.</p>\r\n                        <div className=\"popup-actions\">\r\n                            <button\r\n                                className=\"cancel-btn\"\r\n                                onClick={() => setConfirmPopup(false)}\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button className=\"place-btn\" onClick={placeOrder}>\r\n                                Place Order\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}