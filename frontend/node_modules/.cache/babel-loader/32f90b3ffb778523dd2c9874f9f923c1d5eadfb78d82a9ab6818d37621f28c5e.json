{"ast":null,"code":"// frontend/src/components/Cart/Payment.jsx\nimport React,{useState,useContext,useEffect}from\"react\";import{CartContext}from\"../../contexts/CartContext\";import{useNavigate}from\"react-router-dom\";import API from\"../../api/api\";import\"./Payments.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Payment(){const{cart,clearCart}=useContext(CartContext);const navigate=useNavigate();const[selectedMethod,setSelectedMethod]=useState(\"COD\");const[confirmPopup,setConfirmPopup]=useState(false);const[shippingDetails,setShippingDetails]=useState(null);const[loading,setLoading]=useState(false);// üîπ Load shipping details\nuseEffect(()=>{const saved=localStorage.getItem(\"shippingDetails\");if(!saved){navigate(\"/checkout\");return;}setShippingDetails(JSON.parse(saved));},[navigate]);// üîπ Calculate total safely\nconst totalPrice=cart.reduce((sum,item)=>sum+Number(item.price)*item.qty,0);// üîπ PLACE ORDER (FULLY FIXED)\nconst placeOrder=async()=>{if(cart.length===0){alert(\"Cart is empty\");return;}if(!shippingDetails){alert(\"Shipping details missing\");navigate(\"/checkout\");return;}const token=localStorage.getItem(\"token\");if(!token){alert(\"Please login to place order\");navigate(\"/login\");return;}try{setLoading(true);const orderData={orderItems:cart.map(item=>({product:item._id,name:item.name,price:Number(item.price),qty:item.qty,image:item.image||\"\"})),shippingAddress:shippingDetails,paymentMethod:selectedMethod,totalPrice};console.log(\"üì¶ Sending Order:\",orderData);const res=await API.post(\"/orders\",orderData,{headers:{Authorization:\"Bearer \".concat(token)}});console.log(\"‚úÖ ORDER CREATED:\",res.data);clearCart();localStorage.removeItem(\"shippingDetails\");// üîπ backend usually returns order directly\nnavigate(\"/order-success/\".concat(res.data._id));}catch(error){var _error$response,_error$response2,_error$response2$data;console.error(\"‚ùå ORDER ERROR:\",((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error.message);alert(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||\"Order failed. Please try again.\");}finally{setLoading(false);setConfirmPopup(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"payment-page\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Select Payment Method\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-box\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment-option \".concat(selectedMethod===\"COD\"?\"active\":\"\"),onClick:()=>setSelectedMethod(\"COD\"),children:\"Cash on Delivery (COD)\"}),/*#__PURE__*/_jsx(\"button\",{className:\"continue-btn\",onClick:()=>setConfirmPopup(true),disabled:cart.length===0,children:\"Continue\"})]}),confirmPopup&&/*#__PURE__*/_jsx(\"div\",{className:\"popup-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"popup-box\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Confirm Order?\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total Amount: \\u20B9\",totalPrice]}),/*#__PURE__*/_jsxs(\"div\",{className:\"popup-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"cancel-btn\",onClick:()=>setConfirmPopup(false),disabled:loading,children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{className:\"place-btn\",onClick:placeOrder,disabled:loading,children:loading?\"Placing...\":\"Place Order\"})]})]})})]});}","map":{"version":3,"names":["React","useState","useContext","useEffect","CartContext","useNavigate","API","jsx","_jsx","jsxs","_jsxs","Payment","cart","clearCart","navigate","selectedMethod","setSelectedMethod","confirmPopup","setConfirmPopup","shippingDetails","setShippingDetails","loading","setLoading","saved","localStorage","getItem","JSON","parse","totalPrice","reduce","sum","item","Number","price","qty","placeOrder","length","alert","token","orderData","orderItems","map","product","_id","name","image","shippingAddress","paymentMethod","console","log","res","post","headers","Authorization","concat","data","removeItem","error","_error$response","_error$response2","_error$response2$data","response","message","className","children","onClick","disabled"],"sources":["C:/Users/anakhiya nikhil/OneDrive/Desktop/mern-ecommerce-full/Gurukrupa-Site/frontend/src/components/Cart/payment.jsx"],"sourcesContent":["// frontend/src/components/Cart/Payment.jsx\r\nimport React, { useState, useContext, useEffect } from \"react\";\r\nimport { CartContext } from \"../../contexts/CartContext\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport API from \"../../api/api\";\r\nimport \"./Payments.css\";\r\n\r\nexport default function Payment() {\r\n    const { cart, clearCart } = useContext(CartContext);\r\n    const navigate = useNavigate();\r\n\r\n    const [selectedMethod, setSelectedMethod] = useState(\"COD\");\r\n    const [confirmPopup, setConfirmPopup] = useState(false);\r\n    const [shippingDetails, setShippingDetails] = useState(null);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // üîπ Load shipping details\r\n    useEffect(() => {\r\n        const saved = localStorage.getItem(\"shippingDetails\");\r\n        if (!saved) {\r\n            navigate(\"/checkout\");\r\n            return;\r\n        }\r\n        setShippingDetails(JSON.parse(saved));\r\n    }, [navigate]);\r\n\r\n    // üîπ Calculate total safely\r\n    const totalPrice = cart.reduce(\r\n        (sum, item) => sum + Number(item.price) * item.qty,\r\n        0\r\n    );\r\n\r\n    // üîπ PLACE ORDER (FULLY FIXED)\r\n    const placeOrder = async () => {\r\n        if (cart.length === 0) {\r\n            alert(\"Cart is empty\");\r\n            return;\r\n        }\r\n\r\n        if (!shippingDetails) {\r\n            alert(\"Shipping details missing\");\r\n            navigate(\"/checkout\");\r\n            return;\r\n        }\r\n\r\n        const token = localStorage.getItem(\"token\");\r\n        if (!token) {\r\n            alert(\"Please login to place order\");\r\n            navigate(\"/login\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setLoading(true);\r\n\r\n            const orderData = {\r\n                orderItems: cart.map(item => ({\r\n                    product: item._id,\r\n                    name: item.name,\r\n                    price: Number(item.price),\r\n                    qty: item.qty,\r\n                    image: item.image || \"\"\r\n                })),\r\n                shippingAddress: shippingDetails,\r\n                paymentMethod: selectedMethod,\r\n                totalPrice\r\n            };\r\n\r\n            console.log(\"üì¶ Sending Order:\", orderData);\r\n\r\n            const res = await API.post(\r\n                \"/orders\",\r\n                orderData,\r\n                {\r\n                    headers: {\r\n                        Authorization: `Bearer ${token}`\r\n                    }\r\n                }\r\n            );\r\n\r\n            console.log(\"‚úÖ ORDER CREATED:\", res.data);\r\n\r\n            clearCart();\r\n            localStorage.removeItem(\"shippingDetails\");\r\n\r\n            // üîπ backend usually returns order directly\r\n            navigate(`/order-success/${res.data._id}`);\r\n        } catch (error) {\r\n            console.error(\"‚ùå ORDER ERROR:\", error.response?.data || error.message);\r\n            alert(\r\n                error.response?.data?.message ||\r\n                \"Order failed. Please try again.\"\r\n            );\r\n        } finally {\r\n            setLoading(false);\r\n            setConfirmPopup(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"payment-page\">\r\n            <h2>Select Payment Method</h2>\r\n\r\n            <div className=\"payment-box\">\r\n                <div\r\n                    className={`payment-option ${selectedMethod === \"COD\" ? \"active\" : \"\"\r\n                        }`}\r\n                    onClick={() => setSelectedMethod(\"COD\")}\r\n                >\r\n                    Cash on Delivery (COD)\r\n                </div>\r\n\r\n                <button\r\n                    className=\"continue-btn\"\r\n                    onClick={() => setConfirmPopup(true)}\r\n                    disabled={cart.length === 0}\r\n                >\r\n                    Continue\r\n                </button>\r\n            </div>\r\n\r\n            {confirmPopup && (\r\n                <div className=\"popup-overlay\">\r\n                    <div className=\"popup-box\">\r\n                        <h3>Confirm Order?</h3>\r\n                        <p>Total Amount: ‚Çπ{totalPrice}</p>\r\n\r\n                        <div className=\"popup-actions\">\r\n                            <button\r\n                                className=\"cancel-btn\"\r\n                                onClick={() => setConfirmPopup(false)}\r\n                                disabled={loading}\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n\r\n                            <button\r\n                                className=\"place-btn\"\r\n                                onClick={placeOrder}\r\n                                disabled={loading}\r\n                            >\r\n                                {loading ? \"Placing...\" : \"Place Order\"}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,UAAU,CAAEC,SAAS,KAAQ,OAAO,CAC9D,OAASC,WAAW,KAAQ,4BAA4B,CACxD,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,MAAO,CAAAC,GAAG,KAAM,eAAe,CAC/B,MAAO,gBAAgB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAExB,cAAe,SAAS,CAAAC,OAAOA,CAAA,CAAG,CAC9B,KAAM,CAAEC,IAAI,CAAEC,SAAU,CAAC,CAAGX,UAAU,CAACE,WAAW,CAAC,CACnD,KAAM,CAAAU,QAAQ,CAAGT,WAAW,CAAC,CAAC,CAE9B,KAAM,CAACU,cAAc,CAAEC,iBAAiB,CAAC,CAAGf,QAAQ,CAAC,KAAK,CAAC,CAC3D,KAAM,CAACgB,YAAY,CAAEC,eAAe,CAAC,CAAGjB,QAAQ,CAAC,KAAK,CAAC,CACvD,KAAM,CAACkB,eAAe,CAAEC,kBAAkB,CAAC,CAAGnB,QAAQ,CAAC,IAAI,CAAC,CAC5D,KAAM,CAACoB,OAAO,CAAEC,UAAU,CAAC,CAAGrB,QAAQ,CAAC,KAAK,CAAC,CAE7C;AACAE,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAoB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,iBAAiB,CAAC,CACrD,GAAI,CAACF,KAAK,CAAE,CACRT,QAAQ,CAAC,WAAW,CAAC,CACrB,OACJ,CACAM,kBAAkB,CAACM,IAAI,CAACC,KAAK,CAACJ,KAAK,CAAC,CAAC,CACzC,CAAC,CAAE,CAACT,QAAQ,CAAC,CAAC,CAEd;AACA,KAAM,CAAAc,UAAU,CAAGhB,IAAI,CAACiB,MAAM,CAC1B,CAACC,GAAG,CAAEC,IAAI,GAAKD,GAAG,CAAGE,MAAM,CAACD,IAAI,CAACE,KAAK,CAAC,CAAGF,IAAI,CAACG,GAAG,CAClD,CACJ,CAAC,CAED;AACA,KAAM,CAAAC,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC3B,GAAIvB,IAAI,CAACwB,MAAM,GAAK,CAAC,CAAE,CACnBC,KAAK,CAAC,eAAe,CAAC,CACtB,OACJ,CAEA,GAAI,CAAClB,eAAe,CAAE,CAClBkB,KAAK,CAAC,0BAA0B,CAAC,CACjCvB,QAAQ,CAAC,WAAW,CAAC,CACrB,OACJ,CAEA,KAAM,CAAAwB,KAAK,CAAGd,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAACa,KAAK,CAAE,CACRD,KAAK,CAAC,6BAA6B,CAAC,CACpCvB,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACJ,CAEA,GAAI,CACAQ,UAAU,CAAC,IAAI,CAAC,CAEhB,KAAM,CAAAiB,SAAS,CAAG,CACdC,UAAU,CAAE5B,IAAI,CAAC6B,GAAG,CAACV,IAAI,GAAK,CAC1BW,OAAO,CAAEX,IAAI,CAACY,GAAG,CACjBC,IAAI,CAAEb,IAAI,CAACa,IAAI,CACfX,KAAK,CAAED,MAAM,CAACD,IAAI,CAACE,KAAK,CAAC,CACzBC,GAAG,CAAEH,IAAI,CAACG,GAAG,CACbW,KAAK,CAAEd,IAAI,CAACc,KAAK,EAAI,EACzB,CAAC,CAAC,CAAC,CACHC,eAAe,CAAE3B,eAAe,CAChC4B,aAAa,CAAEhC,cAAc,CAC7Ba,UACJ,CAAC,CAEDoB,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAEV,SAAS,CAAC,CAE3C,KAAM,CAAAW,GAAG,CAAG,KAAM,CAAA5C,GAAG,CAAC6C,IAAI,CACtB,SAAS,CACTZ,SAAS,CACT,CACIa,OAAO,CAAE,CACLC,aAAa,WAAAC,MAAA,CAAYhB,KAAK,CAClC,CACJ,CACJ,CAAC,CAEDU,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAEC,GAAG,CAACK,IAAI,CAAC,CAEzC1C,SAAS,CAAC,CAAC,CACXW,YAAY,CAACgC,UAAU,CAAC,iBAAiB,CAAC,CAE1C;AACA1C,QAAQ,mBAAAwC,MAAA,CAAmBJ,GAAG,CAACK,IAAI,CAACZ,GAAG,CAAE,CAAC,CAC9C,CAAE,MAAOc,KAAK,CAAE,KAAAC,eAAA,CAAAC,gBAAA,CAAAC,qBAAA,CACZZ,OAAO,CAACS,KAAK,CAAC,gBAAgB,CAAE,EAAAC,eAAA,CAAAD,KAAK,CAACI,QAAQ,UAAAH,eAAA,iBAAdA,eAAA,CAAgBH,IAAI,GAAIE,KAAK,CAACK,OAAO,CAAC,CACtEzB,KAAK,CACD,EAAAsB,gBAAA,CAAAF,KAAK,CAACI,QAAQ,UAAAF,gBAAA,kBAAAC,qBAAA,CAAdD,gBAAA,CAAgBJ,IAAI,UAAAK,qBAAA,iBAApBA,qBAAA,CAAsBE,OAAO,GAC7B,iCACJ,CAAC,CACL,CAAC,OAAS,CACNxC,UAAU,CAAC,KAAK,CAAC,CACjBJ,eAAe,CAAC,KAAK,CAAC,CAC1B,CACJ,CAAC,CAED,mBACIR,KAAA,QAAKqD,SAAS,CAAC,cAAc,CAAAC,QAAA,eACzBxD,IAAA,OAAAwD,QAAA,CAAI,uBAAqB,CAAI,CAAC,cAE9BtD,KAAA,QAAKqD,SAAS,CAAC,aAAa,CAAAC,QAAA,eACxBxD,IAAA,QACIuD,SAAS,mBAAAT,MAAA,CAAoBvC,cAAc,GAAK,KAAK,CAAG,QAAQ,CAAG,EAAE,CAC9D,CACPkD,OAAO,CAAEA,CAAA,GAAMjD,iBAAiB,CAAC,KAAK,CAAE,CAAAgD,QAAA,CAC3C,wBAED,CAAK,CAAC,cAENxD,IAAA,WACIuD,SAAS,CAAC,cAAc,CACxBE,OAAO,CAAEA,CAAA,GAAM/C,eAAe,CAAC,IAAI,CAAE,CACrCgD,QAAQ,CAAEtD,IAAI,CAACwB,MAAM,GAAK,CAAE,CAAA4B,QAAA,CAC/B,UAED,CAAQ,CAAC,EACR,CAAC,CAEL/C,YAAY,eACTT,IAAA,QAAKuD,SAAS,CAAC,eAAe,CAAAC,QAAA,cAC1BtD,KAAA,QAAKqD,SAAS,CAAC,WAAW,CAAAC,QAAA,eACtBxD,IAAA,OAAAwD,QAAA,CAAI,gBAAc,CAAI,CAAC,cACvBtD,KAAA,MAAAsD,QAAA,EAAG,sBAAe,CAACpC,UAAU,EAAI,CAAC,cAElClB,KAAA,QAAKqD,SAAS,CAAC,eAAe,CAAAC,QAAA,eAC1BxD,IAAA,WACIuD,SAAS,CAAC,YAAY,CACtBE,OAAO,CAAEA,CAAA,GAAM/C,eAAe,CAAC,KAAK,CAAE,CACtCgD,QAAQ,CAAE7C,OAAQ,CAAA2C,QAAA,CACrB,QAED,CAAQ,CAAC,cAETxD,IAAA,WACIuD,SAAS,CAAC,WAAW,CACrBE,OAAO,CAAE9B,UAAW,CACpB+B,QAAQ,CAAE7C,OAAQ,CAAA2C,QAAA,CAEjB3C,OAAO,CAAG,YAAY,CAAG,aAAa,CACnC,CAAC,EACR,CAAC,EACL,CAAC,CACL,CACR,EACA,CAAC,CAEd","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}